<script>
    onmessage = async (event) => {
        fetch('https://qurle.net/api/send.php',
            {
                method: 'POST',
                body: JSON.stringify({
                    'k': event.data.pluginMessage.k,
                    'v': event.data.pluginMessage.v,
                    'plugin': event.data.pluginMessage.plugin
                }),
                headers: {
                    'Content-Type': 'application/json',
                },
            })
            .then(response => {
                if (event.data.pluginMessage.last)
                    parent.postMessage({ pluginMessage: "finished" }, '*')
            }).catch((e) => {
                console.error(e)
                parent.postMessage({ pluginMessage: "finished" }, '*')
            })
    }
</script>